{% extends 'base/base.html' %}
{% load static %}
{% load humanize %}
{% load custom_tags %}
{% block title %}
{% load mathfilters %}
Target Summary for {{target.name}}
{% endblock title %}

{% block custom_js_css_link %}
<link rel="stylesheet" type="text/css" href="{% static 'plugins/datatable/datatables.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/datatable/global.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'plugins/datatable/custom.css' %}">
<link href="{% static 'plugins/select2/select2.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'plugins/perfect-scrollbar/perfect-scrollbar.css' %}" rel="stylesheet" type="text/css" />
{% endblock custom_js_css_link %}

{% block breadcrumb_title %}
<li class="breadcrumb-item"><a href="{% url 'list_target' %}">Targets</a></li>
<li class="breadcrumb-item active">Target Summary</li>
<li class="breadcrumb-item active" aria-current="page">{{target.name}}</li>
{% endblock breadcrumb_title %}

{% block page_title %}
Target Summary
{% endblock page_title %}

{% block main_content %}
<span aria-current="page" style="display: none">{{target.name}}</span>
<div class="row">
	<div class="col-12">
		<div class="card">
			<ul class="nav nav-tabs nav-bordered m-1">
				<li class="nav-item">
					<a class="nav-link active" id="pills-summary-tab" data-toggle="pill" href="#pills-summary" role="tab" aria-controls="pills-summary" aria-selected="true">Home</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="pills-subdomain-tab" data-toggle="pill" href="#pills-subdomain" role="tab" aria-controls="pills-subdomain" aria-selected="false">Subdomains</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="pills-endpoints-tab" data-toggle="pill" href="#pills-endpoints" role="tab" aria-controls="pills-directories" aria-selected="false">URLs</a>
				</li>
				<li class="nav-item">
					<a class="nav-link" id="pills-vulnerabilities-tab" data-toggle="pill" href="#pills-vulnerabilities" role="tab" aria-controls="pills-vulnerabilities" aria-selected="false">Vulnerabilities</a>
				</li>
			</ul>
		</div>
	</div>
</div>
<input type="hidden" name="summary_identifier" value="{{target.id}}" id="summary_identifier_val">

<div class="tab-content no-padding-tab">
	<div class="tab-pane show active" id="pills-summary" role="tabpanel" aria-labelledby="pills-summary-tab">
		<div class="row">
			<div class="col-xl-3 col-lg-4">
				<div class="card">
					<div class="card-body">
						<div class="d-flex align-items-start mb-3">
							<div class="w-100">
								<h5 class="mt-0 mb-0 font-15">
									Scan Timeline
								</h5>
								<div class="mt-1">
									<small>
										Target <span class="badge badge-soft-primary">{{target.name}}</span> has been scanned <b>{{scan_count}}</b> times.
										<br>
										<br>
										{% if scan_count %}
										The most recent scan was performed on <span class="text-primary">&nbsp;{{recent_scans.0.start_scan_date}} , {{recent_scans.0.start_scan_date|naturaltime}}</span>
										{% endif %}
									</small>
								</div>
								<div class="track-order-list mt-3">
									<ul class="list-unstyled">
										{% for scan in recent_scans %}
										<li class="completed">
											<a href="{% url 'detail_scan' scan.id %}">
												<h5 class="mt-0 mb-1">
													{{scan.scan_type.engine_name}}
													{% if scan.scan_status == -1 %}
													<span class="badge badge-soft-warning float-end">Pending</span>
													{% elif scan.scan_status == 0 %}
													<span class="badge badge-soft-danger float-end">Failed</span>
													{% elif scan.scan_status == 1 %}
													<span class="badge badge-soft-primary float-end">Scanning</span>
													{% elif scan.scan_status == 2 %}
													<span class="badge badge-soft-success float-end">Completed</span>
													{% elif scan.scan_status == 3 %}
													<span class="badge badge-soft-danger float-end">Aborted</span>
													{% else %}
													<span class="badge badge-soft-danger float-end">Unknown</span>
													{% endif %}
												</h5>
												<p class="text-muted">{{scan.start_scan_date|naturaltime}}<br><small class="text-muted">{{scan.start_scan_date}}</small></p>
												<p class="text-primary">
													{{scan.get_subdomain_count}} Subdomains Discovered
													<span class="float-end text-dark">
														{% with next_element=recent_scans|next:forloop.counter0 %}
														{% if next_element.get_subdomain_count and scan.get_subdomain_count and next_element.get_subdomain_count > scan.get_subdomain_count %}
														<span class="text-danger" data-toggle="tooltip" data-placement="top" title="{{scan.get_subdomain_count|sub:next_element.get_subdomain_count|abs}} subdomains missing since last scan."><i class="fa fa-caret-down text-danger me-1"></i>{{scan.get_subdomain_count|sub:next_element.get_subdomain_count}} Subdomains</span>
														{% elif next_element.get_subdomain_count and scan.get_subdomain_count and next_element.get_subdomain_count < scan.get_subdomain_count %}
														<span class="text-success" data-toggle="tooltip" data-placement="top" title="{{scan.get_subdomain_count|sub:next_element.get_subdomain_count}} subdomains added since last scan."><i class="fa fa-caret-up text-success me-1"></i>{{scan.get_subdomain_count|sub:next_element.get_subdomain_count}} Subdomains</span>
														{% endif %}
														{% endwith %}
													</span>
												</p>
											</a>
										</li>
										{% endfor %}
									</ul>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="card">
					<div class="card-body">
						<div class="d-flex align-items-start mb-3">
							<div class="w-100">
								<h5 class="mt-0 mb-0 font-15">
									<span id="sub_scan_history_count"></span> Sub Scans</span>
								</h5>
								<div data-simplebar style="max-height: 510px;" class="p-2">
									<div id="subscan_history_widget">
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-xl-9 col-lg-8">
				<div class="row">
					<div class="col-xl-3 col-lg-3 col-6">
						<div class="card" id="tooltip-container">
							<div class="card-body">
								<i class="fa fa-info-circle text-muted float-end" data-bs-container="#tooltip-container" data-bs-toggle="tooltip" data-bs-placement="bottom" title="The total times {{target.name}} is scanned."></i>
								<h4 class="mt-0 font-16">Times target is scanned</h4>
								<h2 class="text-primary my-3 text-center"><span data-plugin="counterup">{{scan_count|intcomma}}</span></h2>
								<br>
								<p class="mb-0"><span class="badge badge-soft-primary">{{this_week_scan_count}} Scans this week</span></p>
							</div>
						</div>
					</div>

					<div class="col-xl-3 col-lg-3 col-6">
						<div class="card" id="tooltip-container">
							<div class="card-body">
								<i class="fa fa-info-circle text-muted float-end" data-bs-container="#tooltip-container" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Total Subdomains Discovered by reNgine during this scan"></i>
								<h4 class="mt-0 font-16">Subdomains Discovered</h4>
								<h2 class="text-primary my-3 text-center"><span data-plugin="counterup">{{subdomain_count|intcomma}}</span></h2>
								<br>
								<p class="mb-0"><span class="badge badge-soft-success">Alive Subdomains: {{alive_count}}</span></p>
							</div>
						</div>
					</div>

					<div class="col-xl-3 col-lg-3 col-6">
						<div class="card" id="tooltip-container1">
							<div class="card-body">
								<i class="fa fa-info-circle text-muted float-end" data-bs-container="#tooltip-container1" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Total Endpoints discovered for this target. This includes any URLs discovered."></i>
								<h4 class="mt-0 font-16">Endpoints Discovered</h4>
								<h2 class="text-primary my-3 text-center"><span data-plugin="counterup">{{endpoint_count|intcomma}}</span></h2>
								<br>
								<p class="text-success mb-0"><span class="badge badge-soft-success">Alive Endpoints: {{endpoint_alive_count}}</span></p>
							</div>
						</div>
					</div>

					<div class="col-xl-3 col-lg-3 col-6">
						<div class="card" id="tooltip-container2">
							<div class="card-body">
								<i class="fa fa-info-circle text-muted float-end" data-bs-container="#tooltip-container2" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Total Vulnerabilities discovered for this target. This will be populated only if vulnerability scan is performed during any scan."></i>
								<h4 class="mt-0 font-16">Vulnerabilities Discovered</h4>
								<h2 class="text-danger my-3 text-center"><span data-plugin="counterup">{{vulnerability_count|intcomma}}</span></h2>
								<p class="text-muted mb-0">
									<span class="w-title text-danger">{{critical_count}} Critical, {{high_count}} High, {{medium_count}} Medium</span>
									<br>
									<span class="w-title text-primary">{{low_count}} Low, {{info_count}} Info Vulnerabilities</span>
								</p>
							</div>
						</div>
					</div>

				</div>
				<div class="row">
					<div class="col-xl-7 col-lg-7 col-12">
						<div class="card" style="height: 95%">
							<div class="card-body">
								<div class="card-widgets">
									<a href="javascript: fetch_whois('{{target.name}}', true);" data-toggle="tooltip" title="Reload Whois"><i class="mdi mdi-refresh"></i></a>
								</div>
								<h4 class="header-title mb-0"><span class="text-primary"><i class="fe-activity"></i></span>&nbsp;Target Information</h4>
								<div class="row mt-3">
									<div class="col-sm-3">
										<div class="nav flex-column nav-pills nav-pills-tab" id="v-pills-tab" role="tablist" aria-orientation="vertical">
											<a class="nav-link active show mb-1" id="v-pills-domain-tab" data-bs-toggle="pill" href="#v-pills-domain" role="tab" aria-controls="v-pills-domain-tab" aria-selected="true">Domain info</a>
											<a class="nav-link mb-1" id="v-pills-whois-tab" data-bs-toggle="pill" href="#v-pills-whois" role="tab" aria-controls="v-pills-whois" aria-selected="false">Whois</a>
											<a class="nav-link mb-1" id="v-pills-nameserver-tab" data-bs-toggle="pill" href="#v-pills-nameserver" role="tab" aria-controls="v-pills-nameserver"aria-selected="false">Nameservers</a>
											<a class="nav-link mb-1" id="v-pills-history-tab" data-bs-toggle="pill" href="#v-pills-history" role="tab" aria-controls="v-pills-history"aria-selected="false">NS History</a>
										</div>
									</div> <!-- end col-->
									<div class="col-sm-9">
										<div class="tab-content pt-0">
											<div class="tab-pane fade active show" id="v-pills-domain" role="tabpanel" aria-labelledby="v-pills-domain-tab" data-simplebar style="max-height: 300px; min-height: 300px;">
												{% if not target.domain_info %}
												<div class="alert alert-danger alert-dismissible fade show" role="alert" id="whois_not_fetched_alert">
													<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
													WHOIS Record Has not been fetched, would you like to <a href="javascript: fetch_whois('{{target}}', true);">fetch it now?</a>
												</div>
												{% endif %}
												<div class="alert alert-info alert-dismissible fade show" role="alert" id="whois_fetching_alert" style="display: none">
													Fetching WHOIS records, Please wait...
													<div class="spinner-border spinner-border-sm float-end" role="status"></div>
												</div>
												<div class="alert alert-success alert-dismissible fade show" role="alert" id="whois_fetched_alert" style="display: none">
													WHOIS Records have been fetched, please <a href="javascript:location.reload();">reload the page.</a>
												</div>
												<h4 class="header-title">Domain Information</h4>
												<table class="domain_details_table table table-hover table-borderless">
													<tr style="display: none">
														<th>&nbsp;</th>
														<th>&nbsp;</th>
													</tr>
													<tr>
														<td>Domain Name</td>
														<td>{{target.name}}</td>
													</tr>
													<tr>
														<td>Domain age</td>
														<td id="domain_age">{{target.domain_info.domain_age}}</td>
													</tr>
													<tr>
														<td>IP Address</td>
														<td id="ip_address">{{target.domain_info.ip_address}}</td>
													</tr>
													<tr>
														<td>IP Geolocation</td>
														<td id="ip_geolocation">{% if target.domain_info.geolocation_iso %}<img src="https://domainbigdata.com/img/flags-iso/flat/24/{{target.domain_info.geolocation_iso}}.png" alt="{{target.domain_info.geolocation_iso}}">{% endif %} {{target.domain_info.geolocation}}</td>
													</tr>
												</table>
												<h4 class="header-title mt-3">Registrant Information</h4>
												<table class="domain_details_table table table-hover table-borderless">
													<tr style="display: none">
														<th>&nbsp;</th>
														<th>&nbsp;</th>
													</tr>
													<tr>
														<td>Name</td>
														<td id="registrant_name">{{target.domain_info.whois.registrant.name}}</td>
													</tr>
													<tr>
														<td>Email</td>
														<td id="registrant_email">{{target.domain_info.whois.registrant.email}}</td>
													</tr>
													<tr>
														<td>Organization</td>
														<td id="registrant_organization">{{target.domain_info.whois.registrant.organization}}</td>
													</tr>
													<tr>
														<td>Address</td>
														<td id="registrant_address">{% if target.domain_info.whois.registrant.country_iso %}<img src="https://domainbigdata.com/img/flags-iso/flat/24/{{target.domain_info.whois.registrant.country_iso}}.png" alt="{{target.domain_info.whois.registrant.country_iso}}">{% endif %} {{target.domain_info.whois.registrant.address}} {{target.domain_info.whois.registrant.City}} {{target.domain_info.whois.registrant.state}} {{target.domain_info.whois.registrant.country}}</td>
													</tr>
													<tr>
														<td>Phone Numbers</td>
														<td id="registrant_phone_numbers">{{target.domain_info.whois.registrant.phone_number}}</td>
													</tr>
													<tr>
														<td>Fax</td>
														<td id="registrant_fax">{{target.domain_info.whois.registrant.fax}}</td>
													</tr>
												</table>
											</div>
											<div class="tab-pane fade" id="v-pills-whois" role="tabpanel" aria-labelledby="v-pills-whois-tab">
												<pre data-simplebar style="max-height: 310px; min-height: 310px;">{{target.domain_info.whois.details}}</pre>
											</div>
											<div class="tab-pane fade" id="v-pills-history" role="tabpanel" aria-labelledby="v-pills-history-tab" data-simplebar style="max-height: 300px; min-height: 300px;">
												{% if target.domain_info.nameserver_history.all %}
												<table class="table table-striped mb-0">
													<thead class="table-dark">
														<td>Date</td>
														<td>Action</td>
														<td>NameServer</td>
													</thead>
													<tbody>
														{% for history in target.domain_info.nameserver_history.all %}
														<tr>
															<td>{{history.date}}</td>
															<td>{{history.action}}</td>
															<td>{{history.server}}</td>
														</tr>
														{% endfor %}
													</tbody>
												</table>
												{% else %}
												No DNS history records found.
												{% endif %}
											</div>
											<div class="tab-pane fade" id="v-pills-nameserver" role="tabpanel" aria-labelledby="v-pills-nameserver-tab" data-simplebar style="max-height: 300px; min-height: 300px;">
												{% if target.domain_info.nameserver_record.all %}
												<table class="table table-striped mb-0">
													<thead class="table-dark">
														<td>Type</td>
														<td>Hostname</td>
														<td>Address</td>
														<td>TTL</td>
														<td>Class</td>
														<td>Preference</td>
													</thead>
													<tbody>
														{% for nameserver in target.domain_info.nameserver_record.all %}
														<tr>
															<td><span class="badge badge-soft-primary me-1 ms-1">{{ nameserver.type}}</span></td>
															<td>{{nameserver.hostname}}</td>
															<td>{{nameserver.address}}</td>
															<td>{{nameserver.ttl}}</td>
															<td>{{nameserver.ns_class}}</td>
															<td>{% if nameserver.preference %}{{nameserver.preference}}{% endif %}</td>
														</tr>
														{% endfor %}
													</tbody>
												</table>
												{% else %}
												No DNS history records found.
												{% endif %}
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-5 col-lg-5 col-12">
						<div class="card" style="height: 95%">
							<div class="card-body">
								<h4 class="header-title mb-0">HTTP Status Breakdown</h4>
								<div id="http_status_chart" class="apex-charts"></div>
							</div>
						</div>
					</div>
					<div class="col-xl-6 col-lg-6 col-12">
						<div class="card" style="height: 95%">
							<div class="card-body">
								<h4 class="header-title mb-0"><span class="text-primary"><i class="fe-link"></i></span>&nbsp;<span class="badge badge-soft-primary">{{target.domain_info.associated_domains.all.count}}</span> Related Domains</h4>
								<div class="row mt-3">
									<div class="col-12" data-simplebar style="max-height: 250px; min-height: 10px;">
										{% for domain in target.domain_info.associated_domains.all %}
										<span class="badge badge-soft-primary badge-link waves-effect waves-light me-1" data-toggle="tooltip" title="Add {{domain}} as target." onclick="add_target('{{domain}}')">{{domain}}</span>
										{% empty %}
										<div class="alert alert-warning" role="alert">
											<i class="mdi mdi-alert-outline me-2"></i> Oops! Could not find any related domains.
										</div>
										{% endfor %}
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-6 col-lg-6 col-12">
						<div class="card" style="height: 95%">
							<div class="card-body">
								<h4 class="header-title mb-0"><span class="text-primary"><i class="fe-link"></i></span>&nbsp;<span class="badge badge-soft-primary">{{target.domain_info.related_tlds.all.count}}</span> Related TLDs</h4>
								<div class="row mt-3">
									<div class="col-12" data-simplebar style="max-height: 250px; min-height: 10px;">
										{% for domain in target.domain_info.related_tlds.all %}
										<span class="badge badge-soft-primary badge-link waves-effect waves-light me-1" data-toggle="tooltip" title="Add {{domain}} as target." onclick="add_target('{{domain}}')">{{domain}}</span>
										{% empty %}
										<div class="alert alert-warning" role="alert">
											<i class="mdi mdi-alert-outline me-2"></i> Oops! Could not find any related TLds.
										</div>
										{% endfor %}
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-5 col-lg-5 col-12">
						<div class="card" style="height: 95%">
							<div class="card-body">
								<h4 class="header-title mb-0">Vulnerability Breakdown by Severity</h4>
								<div id="cardCollpase19" class="collapse pt-3 show" dir="ltr">
									<div class="row mt-3 text-center">
										<div class="col-1">

										</div>
										<div class="col-2">
											<p class="text-critical font-15 mb-1 text-truncate">Critical</p>
											<h4 class="text-critical">{{critical_count}}</h4>
										</div>
										<div class="col-2">
											<p class="text-danger font-15 mb-1 text-truncate">High</p>
											<h4 class="text-danger">{{high_count}}</h4>
										</div>
										<div class="col-2">
											<p class="text-warning font-15 mb-1 text-truncate">Medium</p>
											<h4 class="text-warning">{{medium_count}}</h4>
										</div>
										<div class="col-2">
											<p class="text-low font-15 mb-1 text-truncate">Low</p>
											<h4 class="text-low">{{low_count}}</h4>
										</div>
										<div class="col-2">
											<p class="text-low font-15 mb-1 text-truncate">Info</p>
											<h4 class="text-primary">{{info_count}}</h4>
										</div>
									</div>
									<div id="vulnerability-pie-chart" class="apex-charts"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-7 col-lg-7 col-12">
						<div class="card" style="height: 95%">
							<div class="card-body">
								<h4 class="header-title mb-3">Vulnerability Highlights</h4>
								<div class="inbox-widget table-responsive" data-simplebar style="max-height: 407px;">
									<table class="table table-borderless table-nowrap table-hover table-centered m-0">
										<thead class="table-light">
											<tr>
												<th style="width: 10%">Type</th>
												<th style="width: 35%">Vulnerability</th>
												<th style="width: 10%">Severity</th>
												<th style="width: 45%">Vulnerable URL</th>
											</tr>
										</thead>
										<tbody>
											{% for vulnerability in vulnerability_list %}
											<tr>
												<td><span class="badge badge-soft-primary">{{vulnerability.type}}</span></td>
												<td>
													{{vulnerability.name}}
													{% if vulnerability.cve_ids %}
													<br>
													{% for cve in vulnerability.cve_ids %}
													<span class="badge badge-soft-danger" data-toggle="tooltip" data-placement="top" title="CVE ID">{{cve}}</span>
													{% endfor %}
													{% endif %}
													<br>
													<small class="text-muted">Discovered: {{vulnerability.discovered_date|naturaltime}}</small>
												</td>
												<td>{% if vulnerability.severity == 0 %}
													<span class='badge badge-soft-info'>Info</span>
													{% elif vulnerability.severity == 1 %}
													<span class='badge badge-low'>Low</span>
													{% elif vulnerability.severity == 2 %}
													<span class='badge badge-soft-warning'>Medium</span>
													{% elif vulnerability.severity == 3 %}
													<span class='badge badge-soft-danger'>High</span>
													{% elif vulnerability.severity == 4 %}
													<span class='badge badge-critical'>Critical</span>
													{% endif %}
												</td>
												<td><a href="{{vulnerability.http_url}}" target="_blank" class="text-danger bs-tooltip" title="{{vulnerability.http_url}}">{{vulnerability.http_url|truncatechars:50}}</a></td>
											</tr>
											{% empty %}
											Not enough data.
											{% endfor %}
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-6 col-lg-6 col-12">
						<div class="card">
							<div class="card-body">
								<h4 class="header-title mb-0"><span id="important-count"><span class="spinner-border spinner-border-sm me-1"></span></span>Important Subdomains</h4>
								<div class="p-2" data-simplebar style="max-height: 235px; min-height: 235px;">
									<div id="important-subdomains-list">
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-6 col-lg-6 col-12">
						<div class="card">
							<div class="card-body">
								<h4 class="header-title mb-0"><span id="tasks-count"><span class="spinner-border spinner-border-sm me-1"></span></span>
									Recon Note/Todo
									<!--<span class="text-primary float-end" data-toggle="tooltip" data-placement="top" title="Add Recon Todo" onclick="add_todo_for_scanhistory_modal({{history.id}})">
										<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-plus"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
									</span>-->
								</h4>
								<div class="p-2">
									<div style="max-height: 210px;min-height: 210px;" data-simplebar>
										<ul class="list-group list-group-flush todo-list" id="todo-list"></ul>
									</div>
								</div>
								<div class="modal fade" id="addTaskModal" tabindex="-1" role="dialog" aria-labelledby="addTaskModalTitle" aria-hidden="true">
									<div class="modal-dialog modal-dialog-centered modal-lg" role="document">
										<div class="modal-content">
											<div class="modal-body">
												<div class="compose-box">
													<div class="compose-content" id="addTaskModalTitle">
														<h4 class="header-title">Add Recon Todo</h4>
														<form>
															<input type="hidden" name="summary_identifier" value="{{history.id}}" id="summary_identifier_val">

															<div class="mt-2">
																<label for="todoTitle" class="form-label">Todo Title</label>
																<input id="todoTitle" type="text" placeholder="Todo Title" class="form-control" name="task">
															</div>

															<div class="mt-2">
																<label for="todoSubdomainDropdown" class="form-label">Select Subdomain (Optional)</label>
																<span id="selectedSubdomainCount"></span>
																<select class="w-100 form-control" data-toggle="select2" data-width="100%" id="todoSubdomainDropdown">
																	<option>Choose Subdomain...</option>
																</select>
															</div>

															<div class="">
																<label for="todoDescription" class="form-label">Todo Description (Optional)</label>
																<textarea class="form-control" id="todoDescription" rows="5" spellcheck="false" placeholder="Todo Description"></textarea>
															</div>
														</form>
													</div>
												</div>
											</div>
											<div class="modal-footer">
												<button class="btn btn-primary add-scan-history-todo">Add Recon Todo</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-lg-4 col-12">
						<div class="card">
							<div class="card-body">
								<h4 class="header-title mb-0"><span id="ip-address-count"><span class="spinner-border spinner-border-sm me-1"></span></span> IP Addresses</h4>
								<span class="text-warning float-end">*IP Addresses highlighted with yellow are CDN IP</span>
								<div class="p-2" data-simplebar style="max-height: 235px; min-height: 235px;">
									<div id="ip-address" class="mt-2"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-lg-4 col-12">
						<div class="card">
							<div class="card-body">
								<h4 class="header-title mb-0"><span id="ports-count"><span class="spinner-border spinner-border-sm me-1"></span></span> Discovered Ports</h4>
								<span class="text-danger float-end">*Ports highlighted with red are uncommon Ports</span>
								<div class="p-2" data-simplebar style="max-height: 235px; min-height: 235px;">
									<div id="ports" class="mt-2"></div>
								</div>
							</div>
						</div>
					</div>
					<div class="col-xl-4 col-lg-4 col-12">
						<div class="card">
							<div class="card-body">
								<h4 class="header-title mb-0"><span id="technologies-count"><span class="spinner-border spinner-border-sm me-1"></span></span> Discovered Technologies</h4>
								<span class="text-warning float-end">&nbsp;</span>
								<div class="p-2" data-simplebar style="max-height: 235px; min-height: 235px;">
									<div id="technologies" class="mt-2"></div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

{% endblock main_content %}

{% block page_level_script %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/apexcharts/3.29.0/apexcharts.min.js" integrity="sha512-fe6OklXva8AWoqdwgkE7Ni4uWgHGWxFQWZx4lYehzY2Qrst5YfogjAbnLd6egsoTrnjGI9/LYt1Ont2cKNbP2A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://apexcharts.com/samples/assets/irregular-data-series.js"></script>
<script src="https://apexcharts.com/samples/assets/ohlc.js"></script>
<script src="{% static 'custom/custom.js' %}"></script>
<script src="{% static 'custom/todo.js' %}"></script>
<script src="{% static 'note/js/todo.js' %}"></script>
<script src="{% static 'assets/js/clipboard.min.js' %}"></script>
<script src="{% static 'targetApp/js/target_summary.js' %}"></script>
<script type="text/javascript">

$(document).ready(function(){
	$('[data-toggle="tooltip"]').tooltip();
	// HTTP STATUS Breakdown chart
	// depending on http_status_breakdown, generate color
	var colors = [
		{% for status in http_status_breakdown %}
		{% if status.http_status >= 200 and status.http_status < 300 %}
		'#4CAF50',
		{% elif status.http_status >= 300 and status.http_status < 400 %}
		'#FFC107',
		{% else %}
		'#F44336',
		{% endif %}
		{% endfor %}
	];

	// http_status chart
	var options = {
		series: [{
			name: 'Subdomains',
			data: [{% for status in http_status_breakdown %}
				{{status.http_status__count}},
				{% endfor %}]
			}],
			chart: {
				height: 350,
				type: 'bar',
				events: {
					click: function(chart, w, e) {
						// console.log(chart, w, e)
					}
				}
			},
			colors: colors,
			plotOptions: {
				bar: {
					columnWidth: '45%',
					distributed: true,
				}
			},
			dataLabels: {
				enabled: false
			},
			legend: {
				show: false
			},
			xaxis: {
				categories: [
					{% for status in http_status_breakdown %}
					'{{status.http_status}}',
					{% endfor %}
				],
				labels: {
					style: {
						colors: colors,
						fontSize: '12px'
					}
				}
			}
		};

		var chart = new ApexCharts(document.querySelector("#http_status_chart"), options);
		chart.render();

		// vulnerability pie chart
		var options = {
			chart: {
				type: 'donut',
				height: 280,
			},
			colors: ['#D50000', '#F44336', '#FF6D00', '#FFD600', '#2962FF'],
			dataLabels: {
				enabled: false
			},
			legend: {
				show: !0,
				position: "bottom",
				horizontalAlign: "center",
				verticalAlign: "middle",
				floating: !1,
				fontSize: "15px",
				offsetX: 0,
				offsetY: 7
			},
			plotOptions: {
				pie: {
					donut: {
						size: '70%',
						background: 'transparent',
						labels: {
							show: true,
							name: {
								show: true,
								fontSize: '29px',
								fontFamily: 'Nunito, sans-serif',
								color: undefined,
								offsetY: -10
							},
							value: {
								show: true,
								fontSize: '26px',
								fontFamily: 'Nunito, sans-serif',
								color: '20',
								offsetY: 16,
								formatter: function (val) {
									return val
								}
							},
							total: {
								show: true,
								showAlways: true,
								label: 'Total',
								color: '#888ea8',
								formatter: function (w) {
									return w.globals.seriesTotals.reduce( function(a, b) {
										return a + b
									}, 0)
								}
							}
						}
					}
				}
			},
			series: [{{critical_count}}, {{high_count}}, {{medium_count}}, {{low_count}}, {{info_count}}],
			labels: ['Critical', 'High', 'Medium', 'Low', 'Info'],
			responsive: [{
				breakpoint: 1599,
				options: {
					chart: {
						height: 240
					},
					legend: {
						position: 'bottom'
					}
				},
				breakpoint: 1439,
				options: {
					chart: {
						width: '250px',
						height: '390px'
					},
				},
			}],
		}

		var chart = new ApexCharts(
			document.querySelector("#vulnerability-pie-chart"),
			options
		);

		chart.render()

		// load scan history widget
		loadSubscanHistoryWidget(scan_history_id=null, domain_id={{target.id}});

		get_ips(scan_id=null, domain_id={{target.id}});
		get_technologies(scan_id=null, domain_id={{target.id}});
		get_ports(scan_id=null, domain_id={{target.id}});

	});
</script>
{% endblock page_level_script %}
